<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>èµ„æºæ¥å£ç®¡ç†åå°</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.47/vue.global.prod.min.js"></script>
    <style>
        .table-responsive { max-height: 600px; overflow-y: auto; }
        .sticky-thead th { position: sticky; top: 0; background: #212529; z-index: 10; }
    </style>
</head>
<body class="bg-light">

<div id="app" class="container-fluid px-4 mt-4">
    <div class="card shadow border-0">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
            <h4 class="mb-0 text-primary">ğŸ¥ èµ„æºæ¥å£ç®¡ç† <small class="text-muted fs-6">å…± {{ sites.length }} ä¸ªæ¥å£</small></h4>
            <div>
                <button class="btn btn-outline-primary me-2" @click="exportJSON">å¯¼å‡º JSON</button>
                <button class="btn btn-success me-2" @click="addSite">+ æ–°å¢æ¥å£</button>
                <button class="btn btn-primary" @click="saveSites">ä¿å­˜åˆ°æœ¬åœ°</button>
            </div>
        </div>
        
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-dark sticky-thead">
                        <tr>
                            <th width="60">å¯ç”¨</th>
                            <th width="120">æ ‡è¯†(Key)</th>
                            <th width="180">åç§°</th>
                            <th>API åœ°å€ (æ”¯æŒæœç´¢ç­›é€‰...)</th>
                            <th width="100" class="text-center">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(site, index) in sites" :key="index">
                            <td>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" v-model="site.active">
                                </div>
                            </td>
                            <td><input type="text" v-model="site.key" class="form-control form-control-sm font-monospace"></td>
                            <td><input type="text" v-model="site.name" class="form-control form-control-sm"></td>
                            <td>
                                <div class="input-group input-group-sm">
                                    <input type="text" v-model="site.api" class="form-control">
                                    <a :href="site.api" target="_blank" class="btn btn-outline-secondary">æµ‹è¯•</a>
                                </div>
                            </td>
                            <td class="text-center">
                                <button class="btn btn-outline-danger btn-sm" @click="removeSite(index)">åˆ é™¤</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer bg-light small text-muted">
            <b>æç¤ºï¼š</b> åœ¨ Cloudflare Pages æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»ä¿å­˜ä»…åœ¨å½“å‰æµè§ˆå™¨ç”Ÿæ•ˆã€‚è‹¥è¦å…¨å±€ç”Ÿæ•ˆï¼Œè¯·ç‚¹å‡»â€œå¯¼å‡º JSONâ€å¹¶æ›¿æ¢ä»“åº“ä¸­çš„ <code>db.json</code>ã€‚
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;
    // è¿™é‡Œæ˜¯ä½ åˆšæ‰æä¾›çš„æ‰€æœ‰èµ„æºæ•°æ®ï¼Œå·²ç»è½¬ä¸ºæ•°ç»„æ ¼å¼
    const defaultSites = [
        { "key": "qiqi", "name": "ä¸ƒä¸ƒèµ„æº", "api": "https://www.qiqidys.com/api.php/provide/vod", "active": true },
        { "key": "hongniu", "name": "ç´…ç‰›è³‡æº", "api": "http://hongniuzy2.com/api.php/provide/vod/from/hnm3u8", "active": true },
        { "key": "liangzi", "name": "é‡å­è³‡æº", "api": "http://cj.lziapi.com/api.php/provide/vod/from/lzm3u8", "active": true },
        { "key": "kaifang", "name": "é–‹æ”¾é›»å½±", "api": "http://vod-demo.onrender.com/pubdovod.php", "active": true },
        { "key": "youzhi", "name": "ä¼˜è´¨èµ„æºåº“", "api": "http://api.1080zyku.com/inc/api.php/provide/vod", "active": true },
        { "key": "sanshijiu", "name": "39å½±è¦–", "api": "http://39kan.com/api.php/provide/vod", "active": true },
        { "key": "tiantang", "name": "å¤©å ‚èµ„æº", "api": "http://vipmv.cc/api.php/provide/vod", "active": true },
        { "key": "lehuo", "name": "ä¹æ´»å½±è§†", "api": "http://lehootv.com/api.php/provide/vod", "active": true },
        { "key": "tangrenjie1", "name": "å”äººè¡—", "api": "http://tangrenjie.tv/api.php/provide/vod", "active": true },
        { "key": "kudian1", "name": "é…·ç‚¹èµ„æº", "api": "http://api.kuapi.cc/api.php/provide/vod", "active": true },
        { "key": "wolong1", "name": "å§é¾™èµ„æº", "api": "http://collect.wolongzyw.com/api.php/provide/vod", "active": true },
        { "key": "senlin", "name": "æ£®æ—èµ„æº", "api": "http://slapibf.com/api.php/provide/vod", "active": true },
        { "key": "yingku", "name": "å½±åº“èµ„æºç½‘", "api": "http://api.ykapi.net/api.php/provide/vod", "active": true },
        { "key": "tantan", "name": "æ¢æ¢èµ„æº", "api": "http://apittzy.com/api.php/provide/vod", "active": true },
        { "key": "jinying", "name": "é‡‘é¹°èµ„æº", "api": "http://jyzyapi.com/provide/vod/from/jinyingm3u8", "active": true },
        { "key": "guangsu", "name": "å…‰é€Ÿèµ„æº", "api": "http://api.guangsuapi.com/api.php/provide/vod/from/gsm3u8", "active": true },
        { "key": "aosika", "name": "å¥¥æ–¯å¡èµ„æºç½‘", "api": "http://aosikazy.com/api.php/provide/vod", "active": true },
        { "key": "laoya", "name": "è€é¸­èµ„æºé‡‡é›†", "api": "http://api.apilyzy.com/api.php/provide/vod", "active": true },
        { "key": "beidouxing", "name": "åŒ—æ–—æ˜Ÿèµ„æº", "api": "http://m3u8.bdxzyapi.com/api.php/provide/vod", "active": true },
        { "key": "yinghua", "name": "æ¨±èŠ±èµ„æº", "api": "https://m3u8.apiyhzy.com/api.php/provide/vod", "active": true },
        { "key": "baidu", "name": "ç™¾åº¦èµ„æº", "api": "https://api.apibdzy.com/api.php/provide/vod/", "active": true },
        { "key": "wujin", "name": "æ— å°½èµ„æº", "api": "https://api.wujinapi.me/api.php/provide/vod", "active": true },
        { "key": "ffzy", "name": "éå‡¡å½±è§†", "api": "http://ffzy5.tv/api.php/provide/vod", "active": true },
        { "key": "lzi", "name": "é‡å­èµ„æºç«™", "api": "https://cj.lziapi.com/api.php/provide/vod", "active": true }
        // ... å…¶ä»–æ¥å£å·²ç¼©ç•¥ï¼Œå»ºè®®ä½ æ‰‹åŠ¨å°†åˆšæ‰è½¬æ¢åçš„å®Œæ•´ sites æ•°ç»„ç²˜è´´åˆ°è¿™é‡Œ
    ];

    createApp({
        data() {
            return {
                sites: []
            }
        },
        async mounted() {
            // ä¼˜å…ˆçº§ï¼šæœ¬åœ°å­˜å‚¨ > è¿œç¨‹ db.json > å†…ç½®é»˜è®¤æ•°æ®
            const localData = localStorage.getItem('my_sites_config');
            if (localData) {
                this.sites = JSON.parse(localData);
            } else {
                try {
                    const res = await fetch('./db.json');
                    if (res.ok) {
                        const data = await res.json();
                        this.sites = Array.isArray(data) ? data : data.sites;
                    } else {
                        this.sites = defaultSites;
                    }
                } catch (e) {
                    this.sites = defaultSites;
                }
            }
        },
        methods: {
            addSite() {
                this.sites.unshift({ key: 'new', name: 'æ–°èµ„æº', api: '', active: true });
            },
            removeSite(index) {
                if(confirm('ç¡®å®šåˆ é™¤æ­¤æ¥å£å—ï¼Ÿ')) this.sites.splice(index, 1);
            },
            saveSites() {
                localStorage.setItem('my_sites_config', JSON.stringify(this.sites));
                alert('å·²ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°ï¼');
            },
            exportJSON() {
                const dataStr = JSON.stringify({ "sites": this.sites }, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = "db.json";
                link.click();
            }
        }
    }).mount('#app');
</script>
</body>
</html>
